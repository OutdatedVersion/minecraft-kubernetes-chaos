import org.apache.tools.ant.filters.ReplaceTokens

plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '5.1.0'
}

group 'com.outdatedversion'
version '1.0-SNAPSHOT'

sourceCompatibility = 1.8

def pluginEntryPoint = 'com.outdatedversion.Plugin'

repositories {
    mavenCentral()
    maven {
        url 'https://papermc.io/repo/repository/maven-public/'
    }
}

dependencies {
    compile group: 'io.kubernetes', name: 'client-java', version: '5.0.0'
    compileOnly group: 'com.destroystokyo.paper', name: 'paper-api', version: '1.15.2-R0.1-SNAPSHOT'
    testCompile group: 'junit', name: 'junit', version: '4.12'
}

processResources {
    filter ReplaceTokens, tokens: [
            main: pluginEntryPoint,
            version: project.version + '-' + getGitHash()
    ]
}

def getGitHash() {
    def sout = new ByteArrayOutputStream()

    exec {
        commandLine 'git', 'rev-parse', '--short', 'HEAD'
        standardOutput = sout
    }

    return sout.toString().trim()
}